/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/8.7/samples
 */

plugins {
    id 'java'
    id 'maven-publish'
    id 'com.palantir.git-version' version '3.1.0'
    id 'com.github.bjornvester.xjc' version '1.8.2'
}

def versionDetails = versionDetails()

def versionSuffix =
        (versionDetails.commitDistance > 0
                || ! versionDetails.isCleanTag) ? "-SNAPSHOT" : ""

version = versionDetails.lastTag + versionSuffix

repositories {
    mavenLocal()
    mavenCentral()
}

def os = System.getProperty('os.name').toLowerCase()

apply plugin: 'java'
apply plugin: 'maven-publish'

java {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

xjc {
    xsdDir.set(layout.projectDirectory.dir("../../SGrSpecifications/SchemaDatabase/SGr"))
    useJakarta = true
    addCompilationDependencies = true
    generateEpisode = true
}

dependencies {
    implementation group: 'jakarta.xml.bind', name: 'jakarta.xml.bind-api', version: '4.0.2'
}

publishing {

    repositories {
        maven {
            name = "Nexus"

            if (version.toString().contains('SNAPSHOT')) {
                url = uri("https://nexus.library.smartgridready.ch/repository/maven-snapshots/")
            } else {
                url = uri("https://nexus.library.smartgridready.ch/repository/maven-releases")
            }

            credentials {
                username = findProperty("nexus.username")
                password = findProperty("nexus.password")
            }
        }
    }

    publications {
        mavenJava(MavenPublication) {
            groupId = 'com.smartgridready'
            artifactId = 'sgr-specification'

            from components.java
        }
    }
}
