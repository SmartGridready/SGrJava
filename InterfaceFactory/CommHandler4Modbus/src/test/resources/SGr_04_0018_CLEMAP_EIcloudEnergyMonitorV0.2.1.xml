<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/SGr.xsl"?>
<DeviceFrame xmlns="http://www.smartgridready.com/ns/V0/"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.smartgridready.com/ns/V0/ ../../../../../../SGrSpecifications/SchemaDatabase/SGr/Product/Product.xsd" >
  <deviceName>CLEMAP Energy Monitor</deviceName>
  <manufacturerName>CLEMAP</manufacturerName>
  <specificationOwnerIdentification>0</specificationOwnerIdentification>
  <releaseNotes>
    <state>Draft</state>
  </releaseNotes>
  <deviceInformation>
    <deviceCategory>SubMeterElectricity</deviceCategory>
    <isLocalControl>false</isLocalControl>
    <softwareRevision>1.0.0</softwareRevision>
    <manufacturerSpecificationIdentification>CLEMAP</manufacturerSpecificationIdentification>
  </deviceInformation>
  <configurationList>
    <configurationListElement>
      <name>baseUri</name>
      <dataType>
        <string/>
      </dataType>
      <configurationDescription>
        <textElement>The base URI to connect to the service</textElement>
        <language>en</language>
        <label>BaseURI</label>
      </configurationDescription>
      <configurationDescription>
        <textElement>Die Basis-URI des service</textElement>
        <language>de</language>
        <label>BaseURI</label>
      </configurationDescription>
    </configurationListElement>
</configurationList>
  <interfaceList>
    <restApiInterface>
      <restApiInterfaceDescription>
        <restApiInterfaceSelection>URI</restApiInterfaceSelection>
        <restApiUri>{{baseUri}}</restApiUri>
        <restApiAuthenticationMethod>BearerSecurityScheme</restApiAuthenticationMethod>
        <restApiBearer>
          <restApiServiceCall>
            <requestHeader>
              <header>
                <headerName>Accept</headerName>
                <value>application/json</value>
              </header>
              <header>
                <headerName>Content-Type</headerName>
                <value>application/json</value>
              </header>
            </requestHeader>
            <requestMethod>POST</requestMethod>
            <requestPath>/authentication</requestPath>
            <requestBody>{"strategy": "local", "email": "{{username}}", "password": "{{password}}"}</requestBody>
            <responseQuery>
              <queryType>JMESPathExpression</queryType>
              <query>accessToken</query>
            </responseQuery>
          </restApiServiceCall>
        </restApiBearer>
      </restApiInterfaceDescription>
      <functionalProfileList>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>ActivePowerAC</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Metering</functionalProfileCategory>
              <functionalProfileType>ActivePowerAC</functionalProfileType>
              <levelOfOperation>m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>1</primaryVersionNumber>
                <secondaryVersionNumber>0</secondaryVersionNumber>
                <subReleaseVersionNumber>0</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACtot</dataPointName>
                <dataDirection>RW</dataDirection>
                    <dataType>
                  <float64/>
                </dataType>
                <unit>MEGAWATT_HOURS</unit>
                <minimumValue>0.005</minimumValue>
                <maximumValue>100</maximumValue>
                <unitConversionMultiplicator>0.001</unitConversionMultiplicator>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <!-- Test old style of providing URL parameters -->
                  <requestPath>/digitaltwins?sensor_id={{sensor_id}}</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>sum([[0].ten_sec.p_l1,[0].ten_sec.p_l2,[0].ten_sec.p_l3])</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL1</dataPointName>
                <dataDirection>RW</dataDirection>
                    <dataType>
                  <float64/>
                </dataType>
                <unit>KILOWATT_HOURS</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <!-- Test new style of providing URL parameters -->
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>[0].ten_sec.p_l1</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL2</dataPointName>
                <dataDirection>R</dataDirection>
                    <dataType>
                  <float64/>
                </dataType>
                <unit>KILOWATT_HOURS</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>[0].ten_sec.p_l2</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ActivePowerACL3</dataPointName>
                <dataDirection>W</dataDirection>
                    <dataType>
                  <float64/>
                </dataType>
                <unit>KILOWATT_HOURS</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>[0].ten_sec.p_l3</query>
                  </responseQuery>
                </restApiServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
        <functionalProfileListElement>
          <functionalProfile>
            <functionalProfileName>GPIO</functionalProfileName>
            <functionalProfileIdentification>
              <specificationOwnerIdentification>0</specificationOwnerIdentification>
              <functionalProfileCategory>Actuator</functionalProfileCategory>
              <functionalProfileType>Relais</functionalProfileType>
              <levelOfOperation>4m</levelOfOperation>
              <versionNumber>
                <primaryVersionNumber>0</primaryVersionNumber>
                <secondaryVersionNumber>2</secondaryVersionNumber>
                <subReleaseVersionNumber>1</subReleaseVersionNumber>
              </versionNumber>
            </functionalProfileIdentification>
          </functionalProfile>
          <dataPointList>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ContactR</dataPointName>
                <dataDirection>R</dataDirection>
                <dataType>
                  <boolean/>
                </dataType>
                <unit>NONE</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_boolean</dataType>
                <restApiReadServiceCall>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/digitaltwins?sensor_id={{sensor_id}}</requestPath>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>value</query>
                  </responseQuery>
                </restApiReadServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ContactW</dataPointName>
                <dataDirection>W</dataDirection>
                <dataType>
                  <boolean/>
                </dataType>
                <unit>NONE</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_boolean</dataType>
                <restApiWriteServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                    <header>
                      <headerName>Content-Type</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                  </requestQuery>
                  <requestBody>{ "pin" : 1, "value" : "{{value}}" }</requestBody>
                </restApiWriteServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>ContactRW</dataPointName>
                <dataDirection>RW</dataDirection>
                <dataType>
                  <boolean/>
                </dataType>
                <unit>NONE</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_boolean</dataType>
                <restApiReadServiceCall>
                  <requestMethod>GET</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                    <parameter>
                      <name>pin</name>
                      <value>2</value>
                    </parameter>
                  </requestQuery>
                  <responseQuery>
                    <queryType>JMESPathExpression</queryType>
                    <query>value</query>
                  </responseQuery>
                </restApiReadServiceCall>
                <restApiWriteServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                    <header>
                      <headerName>Content-Type</headerName>
                      <value>application/json</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestQuery>
                    <parameter>
                      <name>sensor_id</name>
                      <value>{{sensor_id}}</value>
                    </parameter>
                    <parameter>
                      <name>pin</name>
                      <value>2</value>
                    </parameter>
                  </requestQuery>
                  <requestBody>{ "pin" : 2, "value" : "{{value}}" }</requestBody>
                </restApiWriteServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
            <dataPointListElement>
              <dataPoint>
                <dataPointName>IORegister</dataPointName>
                <dataDirection>W</dataDirection>
                <dataType>
                  <int8U/>
                </dataType>
                <unit>NONE</unit>
              </dataPoint>
              <restApiDataPointConfiguration>
                <dataType>JSON_number</dataType>
                <restApiWriteServiceCall>
                  <requestHeader>
                    <header>
                      <headerName>Accept</headerName>
                      <value>application/json</value>
                    </header>
                    <header>
                      <headerName>Content-Type</headerName>
                      <value>application/x-www-form-urlencoded</value>
                    </header>
                  </requestHeader>
                  <requestMethod>POST</requestMethod>
                  <requestPath>/digitaltwins</requestPath>
                  <requestForm>
                    <parameter>
                      <name>pins=1..7</name>
                      <value>124</value>
                    </parameter>
                  </requestForm>
                </restApiWriteServiceCall>
              </restApiDataPointConfiguration>
            </dataPointListElement>
          </dataPointList>
        </functionalProfileListElement>
      </functionalProfileList>
    </restApiInterface>
  </interfaceList>
</DeviceFrame>
