/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn more about Gradle by exploring our samples at https://docs.gradle.org/7.3.3/samples
 */

plugins {
    id 'java'
    id 'maven-publish'
}

repositories {
    mavenLocal()
    mavenCentral()
}

apply plugin: 'java'
apply plugin: 'maven-publish'

sourceSets {
    main.java.srcDirs = ['src', '../../../SGrSpecifications/SchemaDatabase/SGr' ]
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

dependencies {
    implementation group: 'org.eclipse.emf', name: 'org.eclipse.emf.ecore', version: '2.24.0'
    implementation group: 'org.eclipse.emf', name: 'org.eclipse.emf.ecore.xmi', version: '2.16.0'
}

jar {
    from sourceSets.main.allSource
}

compileJava {
    dependsOn 'model2Java'
}

clean.doFirst {
    file('src').deleteDir()
}

task model2Java(type: Exec) {

    workingDir '../../'
    commandLine 'cmd', '/K', 'model2Java.bat', project.findProperty('xsd2java.eclipse.home'), project.findProperty('xsd2java.xsd.resource')

    inputs.files(fileTree('../../../SGrSpecifications/SchemaDatabase/SGr'))
    outputs.files(fileTree('model'), fileTree('src'))

    standardOutput = new ByteArrayOutputStream()

    doFirst {
        def generatedSrc = fileTree('src')
        generatedSrc.each { File file -> delete(file) }
        delete('model/emfEI4Modbus.genmodel')
        delete('model.v0.ecore')
    }

    doLast {
        print standardOutput.toString()
    }
}

